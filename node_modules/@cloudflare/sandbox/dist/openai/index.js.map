{"version":3,"file":"index.js","names":["sandbox: Sandbox","output: ShellResult['output']","exitCode: number | null","outcome: ShellOutputResult['outcome']","error: unknown","root: string","result: FileOperationResult","original: string","stack: string[]"],"sources":["../../src/openai/index.ts"],"sourcesContent":["/**\n * OpenAI Agents adapters for executing shell commands and file operations\n * inside a Cloudflare Sandbox.\n */\nimport {\n  type ApplyPatchOperation,\n  type ApplyPatchResult,\n  applyDiff,\n  type Editor as OpenAIEeditor,\n  type Shell as OpenAIShell,\n  type ShellAction,\n  type ShellOutputResult,\n  type ShellResult\n} from '@openai/agents';\n\n// Command result for API responses\nexport interface CommandResult {\n  command: string;\n  stdout: string;\n  stderr: string;\n  exitCode: number | null;\n  timestamp: number;\n}\n\n// File operation result for API responses\nexport interface FileOperationResult {\n  operation: 'create' | 'update' | 'delete';\n  path: string;\n  status: 'completed' | 'failed';\n  output: string;\n  error?: string;\n  timestamp: number;\n}\n\nimport { createLogger, type Logger } from '@repo/shared';\nimport type { Sandbox } from '../sandbox';\n\n// Helper functions for error handling\nfunction isErrorWithProperties(error: unknown): error is {\n  message?: string;\n  exitCode?: number;\n  stdout?: string;\n  stderr?: string;\n  status?: number;\n  stack?: string;\n} {\n  return typeof error === 'object' && error !== null;\n}\n\nfunction getErrorMessage(error: unknown): string {\n  if (isErrorWithProperties(error) && typeof error.message === 'string') {\n    return error.message;\n  }\n  return String(error);\n}\n\n/**\n * Convert unknown values to Error instances when possible so downstream\n * loggers can include stack traces without losing type safety.\n */\nfunction toError(error: unknown): Error | undefined {\n  return error instanceof Error ? error : undefined;\n}\n\n/**\n * Shell implementation that adapts Cloudflare Sandbox exec calls to the\n * OpenAI Agents `Shell` contract, including structured result collection.\n */\nexport class Shell implements OpenAIShell {\n  private cwd: string = '/workspace';\n  public results: CommandResult[] = [];\n  private readonly logger: Logger;\n\n  constructor(private readonly sandbox: Sandbox) {\n    this.logger = createLogger({\n      component: 'sandbox-do',\n      operation: 'openai-shell'\n    });\n  }\n\n  async run(action: ShellAction): Promise<ShellResult> {\n    this.logger.debug('SandboxShell.run called', {\n      commands: action.commands,\n      timeout: action.timeoutMs\n    });\n    const output: ShellResult['output'] = [];\n\n    for (const command of action.commands) {\n      this.logger.debug('Executing command', { command, cwd: this.cwd });\n      let stdout = '';\n      let stderr = '';\n      let exitCode: number | null = 0;\n      let outcome: ShellOutputResult['outcome'] = {\n        type: 'exit',\n        exitCode: 0\n      };\n      try {\n        const result = await this.sandbox.exec(command, {\n          timeout: action.timeoutMs,\n          cwd: this.cwd\n        });\n        stdout = result.stdout;\n        stderr = result.stderr;\n        exitCode = result.exitCode;\n        // exec returns a result even for failed commands, so check success field\n        // Timeout would be indicated by a specific error or exit code\n        outcome = { type: 'exit', exitCode };\n\n        this.logger.debug('Command executed successfully', {\n          command,\n          exitCode,\n          stdoutLength: stdout.length,\n          stderrLength: stderr.length\n        });\n\n        // Log warnings for non-zero exit codes or stderr output\n        if (exitCode !== 0) {\n          this.logger.warn(`Command failed with exit code ${exitCode}`, {\n            command,\n            stderr\n          });\n        } else if (stderr) {\n          this.logger.warn(`Command produced stderr output`, {\n            command,\n            stderr\n          });\n        } else {\n          this.logger.info(`Command completed successfully`, { command });\n        }\n      } catch (error: unknown) {\n        // Handle network/HTTP errors or timeout errors\n        const errorObj = isErrorWithProperties(error) ? error : {};\n        exitCode =\n          typeof errorObj.exitCode === 'number' ? errorObj.exitCode : null;\n        stdout = typeof errorObj.stdout === 'string' ? errorObj.stdout : '';\n        stderr = typeof errorObj.stderr === 'string' ? errorObj.stderr : '';\n\n        // Check if it's a timeout error\n        const errorMessage = getErrorMessage(error);\n        if (\n          errorMessage.includes('timeout') ||\n          errorMessage.includes('Timeout') ||\n          errorMessage.includes('timed out')\n        ) {\n          this.logger.error(`Command timed out`, undefined, {\n            command,\n            timeout: action.timeoutMs\n          });\n          outcome = { type: 'timeout' };\n        } else {\n          this.logger.error(`Error executing command`, toError(error), {\n            command,\n            error: errorMessage || error,\n            exitCode\n          });\n          outcome = { type: 'exit', exitCode: exitCode ?? 1 };\n        }\n      }\n      output.push({\n        command,\n        stdout,\n        stderr,\n        outcome\n      });\n\n      // Collect results for API responses\n      const collectedExitCode =\n        outcome.type === 'exit' ? outcome.exitCode : null;\n      const timestamp = Date.now();\n      this.results.push({\n        command: String(command),\n        stdout: String(stdout),\n        stderr: String(stderr),\n        exitCode: collectedExitCode,\n        timestamp\n      });\n      this.logger.debug('Result collected', {\n        command,\n        exitCode: collectedExitCode,\n        timestamp\n      });\n\n      if (outcome.type === 'timeout') {\n        this.logger.warn('Breaking command loop due to timeout');\n        break;\n      }\n    }\n\n    this.logger.debug('SandboxShell.run completed', {\n      totalCommands: action.commands.length,\n      resultsCount: this.results.length\n    });\n    return {\n      output,\n      providerData: {\n        working_directory: this.cwd\n      }\n    };\n  }\n}\n\n/**\n * Editor implementation that projects applyPatch operations from Agents\n * into calls against the sandbox filesystem APIs.\n */\nexport class Editor implements OpenAIEeditor {\n  public results: FileOperationResult[] = [];\n  private readonly logger: Logger;\n\n  constructor(\n    private readonly sandbox: Sandbox,\n    private readonly root: string = '/workspace'\n  ) {\n    this.logger = createLogger({\n      component: 'sandbox-do',\n      operation: 'openai-editor'\n    });\n  }\n\n  /**\n   * Create a new file inside the sandbox by applying the provided diff.\n   */\n  async createFile(\n    operation: Extract<ApplyPatchOperation, { type: 'create_file' }>\n  ): Promise<ApplyPatchResult | undefined> {\n    const targetPath = this.resolve(operation.path);\n    this.logger.debug('WorkspaceEditor.createFile called', {\n      path: operation.path,\n      targetPath\n    });\n\n    try {\n      // Create parent directory if needed\n      const dirPath = this.getDirname(targetPath);\n      if (dirPath !== this.root && dirPath !== '/') {\n        this.logger.debug('Creating parent directory', { dirPath });\n        await this.sandbox.mkdir(dirPath, { recursive: true });\n      }\n\n      const content = applyDiff('', operation.diff, 'create');\n      this.logger.debug('Writing file content', {\n        path: targetPath,\n        contentLength: content.length\n      });\n      await this.sandbox.writeFile(targetPath, content, { encoding: 'utf-8' });\n      const timestamp = Date.now();\n      const result: FileOperationResult = {\n        operation: 'create',\n        path: operation.path,\n        status: 'completed',\n        output: `Created ${operation.path}`,\n        timestamp\n      };\n      this.results.push(result);\n      this.logger.info('File created successfully', {\n        path: operation.path,\n        timestamp\n      });\n      return { status: 'completed', output: `Created ${operation.path}` };\n    } catch (error: unknown) {\n      const timestamp = Date.now();\n      const errorMessage = getErrorMessage(error);\n      const result: FileOperationResult = {\n        operation: 'create',\n        path: operation.path,\n        status: 'failed',\n        output: `Failed to create ${operation.path}`,\n        error: errorMessage,\n        timestamp\n      };\n      this.results.push(result);\n      this.logger.error('Failed to create file', toError(error), {\n        path: operation.path,\n        error: errorMessage\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Update an existing file by reading its content, applying a diff, and\n   * writing the patched output back to the sandbox.\n   */\n  async updateFile(\n    operation: Extract<ApplyPatchOperation, { type: 'update_file' }>\n  ): Promise<ApplyPatchResult | undefined> {\n    const targetPath = this.resolve(operation.path);\n    this.logger.debug('WorkspaceEditor.updateFile called', {\n      path: operation.path,\n      targetPath\n    });\n\n    try {\n      let original: string;\n      try {\n        this.logger.debug('Reading original file', { path: targetPath });\n        const fileInfo = await this.sandbox.readFile(targetPath, {\n          encoding: 'utf-8'\n        });\n        original = fileInfo.content;\n        this.logger.debug('Original file read', {\n          path: targetPath,\n          originalLength: original.length\n        });\n      } catch (error: unknown) {\n        // Sandbox API may throw errors for missing files\n        const errorObj = isErrorWithProperties(error) ? error : {};\n        const errorMessage = getErrorMessage(error);\n        if (\n          errorMessage.includes('not found') ||\n          errorMessage.includes('ENOENT') ||\n          errorObj.status === 404\n        ) {\n          this.logger.error('Cannot update missing file', undefined, {\n            path: operation.path\n          });\n          throw new Error(`Cannot update missing file: ${operation.path}`);\n        }\n        this.logger.error('Error reading file', toError(error), {\n          path: operation.path,\n          error: errorMessage\n        });\n        throw error;\n      }\n\n      const patched = applyDiff(original, operation.diff);\n      this.logger.debug('Applied diff', {\n        path: targetPath,\n        originalLength: original.length,\n        patchedLength: patched.length\n      });\n      await this.sandbox.writeFile(targetPath, patched, { encoding: 'utf-8' });\n      const timestamp = Date.now();\n      const result: FileOperationResult = {\n        operation: 'update',\n        path: operation.path,\n        status: 'completed',\n        output: `Updated ${operation.path}`,\n        timestamp\n      };\n      this.results.push(result);\n      this.logger.info('File updated successfully', {\n        path: operation.path,\n        timestamp\n      });\n      return { status: 'completed', output: `Updated ${operation.path}` };\n    } catch (error: unknown) {\n      const timestamp = Date.now();\n      const errorMessage = getErrorMessage(error);\n      const result: FileOperationResult = {\n        operation: 'update',\n        path: operation.path,\n        status: 'failed',\n        output: `Failed to update ${operation.path}`,\n        error: errorMessage,\n        timestamp\n      };\n      this.results.push(result);\n      this.logger.error('Failed to update file', toError(error), {\n        path: operation.path,\n        error: errorMessage\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Delete a file that was previously created through applyPatch calls.\n   */\n  async deleteFile(\n    operation: Extract<ApplyPatchOperation, { type: 'delete_file' }>\n  ): Promise<ApplyPatchResult | undefined> {\n    const targetPath = this.resolve(operation.path);\n    this.logger.debug('WorkspaceEditor.deleteFile called', {\n      path: operation.path,\n      targetPath\n    });\n\n    try {\n      await this.sandbox.deleteFile(targetPath);\n      const timestamp = Date.now();\n      const result: FileOperationResult = {\n        operation: 'delete',\n        path: operation.path,\n        status: 'completed',\n        output: `Deleted ${operation.path}`,\n        timestamp\n      };\n      this.results.push(result);\n      this.logger.info('File deleted successfully', {\n        path: operation.path,\n        timestamp\n      });\n      return { status: 'completed', output: `Deleted ${operation.path}` };\n    } catch (error: unknown) {\n      const timestamp = Date.now();\n      const errorMessage = getErrorMessage(error);\n      const result: FileOperationResult = {\n        operation: 'delete',\n        path: operation.path,\n        status: 'failed',\n        output: `Failed to delete ${operation.path}`,\n        error: errorMessage,\n        timestamp\n      };\n      this.results.push(result);\n      this.logger.error('Failed to delete file', toError(error), {\n        path: operation.path,\n        error: errorMessage\n      });\n      throw error;\n    }\n  }\n\n  private resolve(relativePath: string): string {\n    // If the path already starts with the root, strip it to get the relative part\n    let pathToProcess = relativePath;\n    if (relativePath.startsWith(this.root)) {\n      pathToProcess = relativePath.slice(this.root.length);\n      // Remove leading slash if present after stripping root\n      pathToProcess = pathToProcess.replace(/^\\//, '');\n    }\n\n    // Remove leading ./ or / if present, then join with root\n    const normalized = pathToProcess.replace(/^\\.\\//, '').replace(/^\\//, '');\n    const resolved = normalized ? `${this.root}/${normalized}` : this.root;\n\n    // Normalize path separators first\n    const pathWithNormalizedSeparators = resolved.replace(/\\/+/g, '/');\n\n    // Normalize .. segments by processing path segments\n    const segments = pathWithNormalizedSeparators\n      .split('/')\n      .filter((s) => s && s !== '.');\n    const stack: string[] = [];\n\n    for (const segment of segments) {\n      if (segment === '..') {\n        if (stack.length === 0) {\n          throw new Error(`Operation outside workspace: ${relativePath}`);\n        }\n        stack.pop();\n      } else {\n        stack.push(segment);\n      }\n    }\n\n    const normalizedPath = `/${stack.join('/')}`;\n\n    // Ensure the resolved path is within the workspace\n    if (!normalizedPath.startsWith(this.root)) {\n      throw new Error(`Operation outside workspace: ${relativePath}`);\n    }\n\n    return normalizedPath;\n  }\n\n  private getDirname(filePath: string): string {\n    const lastSlash = filePath.lastIndexOf('/');\n    if (lastSlash === -1) {\n      return '/';\n    }\n    return filePath.substring(0, lastSlash) || '/';\n  }\n}\n"],"mappings":"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"}